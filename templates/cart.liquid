{% comment %}
  Ebook Store - Cart Template
  Displays shopping cart for ebook purchases
{% endcomment %}

<div class="ebook-cart-page">
  <div class="container">
    <h1 class="page-title">Your Cart</h1>

    {% if cart.item_count > 0 %}
      <div class="cart-layout">
        <div class="cart-items">
          <div class="cart-header">
            <div class="header-item">Ebook</div>
            <div class="header-price">Price</div>
            <div class="header-quantity">Quantity</div>
            <div class="header-total">Total</div>
          </div>

          {% for item in cart.items %}
            <div class="cart-item" data-line="{{ forloop.index }}">
              <div class="item-image">
                {% if item.image %}
                  <img src="{{ item.image | img_url: '150x' }}" alt="{{ item.title | escape }}">
                {% else %}
                  <div class="placeholder-image-small">
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                      <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                      <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                  </div>
                {% endif %}
              </div>

              <div class="item-details">
                <h3 class="item-title">
                  <a href="{{ item.url }}">{{ item.product.title }}</a>
                </h3>
                {% if item.product.vendor != blank %}
                  <p class="item-author">by {{ item.product.vendor }}</p>
                {% endif %}
                {% unless item.variant.title == 'Default Title' %}
                  <p class="item-variant">{{ item.variant.title }}</p>
                {% endunless %}
                <div class="item-formats">
                  <small>üìÑ PDF ‚Ä¢ üì± EPUB ‚Ä¢ üìñ MOBI</small>
                </div>
              </div>

              <div class="item-price">
                {{ item.price | money }}
              </div>

              <div class="item-quantity">
                <input type="number" 
                       class="quantity-input" 
                       value="{{ item.quantity }}" 
                       min="1" 
                       data-line="{{ forloop.index }}"
                       aria-label="Quantity for {{ item.title }}">
              </div>

              <div class="item-total">
                {{ item.line_price | money }}
              </div>

              <div class="item-remove">
                <a href="{{ item.url_to_remove }}" class="remove-btn" aria-label="Remove {{ item.title }}">
                  ‚úï
                </a>
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="cart-summary">
          <div class="summary-card">
            <h2>Order Summary</h2>
            
            <div class="summary-row">
              <span>Subtotal ({{ cart.item_count }} {% if cart.item_count == 1 %}item{% else %}items{% endif %})</span>
              <span>{{ cart.total_price | money }}</span>
            </div>

            <div class="summary-row discount">
              <span>Discount</span>
              <span>{{ cart.total_discount | money }}</span>
            </div>

            <div class="summary-divider"></div>

            <div class="summary-row total">
              <span>Total</span>
              <span class="total-price">{{ cart.total_price | money }}</span>
            </div>

            <div class="instant-download-notice">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              <p>Instant download available after checkout</p>
            </div>

            <a href="/checkout" class="enterprise-btn btn-checkout">
              Proceed to Checkout
            </a>

            <a href="/collections/all" class="btn-continue-shopping">
              ‚Üê Continue Shopping
            </a>
          </div>

          <div class="secure-checkout-badges">
            <div class="badge-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              <span>Secure Checkout</span>
            </div>
            <div class="badge-item">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              <span>Instant Access</span>
            </div>
          </div>
        </div>
      </div>
    {% else %}
      <div class="empty-cart">
        <div class="empty-cart-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
        </div>
        <h2>Your cart is empty</h2>
        <p>Start building your digital library today!</p>
        <a href="/collections/all" class="enterprise-btn">Browse Ebooks</a>
      </div>
    {% endif %}
  </div>
</div>

<script>
// Update cart quantities
document.querySelectorAll('.quantity-input').forEach(input => {
  input.addEventListener('change', function() {
    const line = this.dataset.line;
    const quantity = this.value;
    
    fetch('/cart/change.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        line: line,
        quantity: quantity
      })
    })
    .then(response => response.json())
    .then(data => {
      location.reload();
    });
  });
});
</script>
